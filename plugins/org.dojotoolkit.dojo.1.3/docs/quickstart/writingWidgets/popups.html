<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Dropdowns and Popups &mdash; Dojo Toolkit v1.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Dojo Toolkit v1.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Quickstart" href="../contents.html" />
    <link rel="next" title="The Template" href="templates.html" />
    <link rel="prev" title="Widget Lifecycle" href="lifecycle.html" />
<script type="text/javascript">
	var djConfig = {
		parseOnLoad:true, 
		isDebug: false
	}
</script>
<script type="text/javascript" src="../../_static/dojo/dojo/dojo.js"></script>
<style type="text/css">
@import "../../_static/dojo/dijit/themes/dijit.css";
@import "../../_static/dojo/dijit/themes/nihilo/nihilo.css";
@import "../../_static/dojo/docs/widget/resources/CodeViewer.css";
@import "../../_static/css/layout.css";
</style>

  </head>
  <body>  

    <div class="document">
	<div id="container">
      <div id="header">
	<div class="container">
		<div id="navHeader">
		  <ul>
		    <li><a href="../../index.html">home</a> |</li>
            <li style="margin-right: 10px">
		      <a href="templates.html" title="The Template"
			 accesskey="N">next</a></li>
            <li >
		      <a href="lifecycle.html" title="Widget Lifecycle"
			 accesskey="P">previous</a> |</li>
		    <li><a href="../../contents.html">Dojo Toolkit v1.3.0 documentation</a> &raquo;</li>
		      <li><a href="../contents.html" accesskey="U">Quickstart</a> &raquo;</li> 
		  </ul>
		</div>
		<div id="searchHeader">
		    <div class="searchContainer">
		        <form class="search" action="../../search.html" method="get">
                    <input class="textInput" type="text" name="q" size="18" />
                    <input class="buttonInput" type="submit" value="Go" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
		    </div>
		</div>
	</div>
      </div>
      <div class="content">
	<div id="content">
		  <div id="contentRight">
			  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../contents.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference" href="">Dropdowns and Popups</a><ul>
<li><a class="reference" href="#parent-widget-always-controls">Parent widget always controls</a></li>
<li><a class="reference" href="#popup-widget">Popup Widget</a></li>
<li><a class="reference" href="#lifecycle">Lifecycle</a></li>
<li><a class="reference" href="#stacks">Stacks</a></li>
<li><a class="reference" href="#keyboard-handling">Keyboard handling</a></li>
<li><a class="reference" href="#popup-dom-node-positioning">Popup DOM node positioning</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="lifecycle.html"
                                  title="previous chapter">Widget Lifecycle</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="templates.html"
                                  title="next chapter">The Template</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../_sources/quickstart/writingWidgets/popups.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </div>
      </div>
		  </div>
		  <div id="contentLeft">
		    <div class="bodywrapper">
		      <div class="body">
			
  <div class="section" id="dropdowns-and-popups">
<span id="quickstart-writingwidgets-popups"></span><h1><a class="toc-backref" href="#id1">Dropdowns and Popups<a class="headerlink" href="#dropdowns-and-popups" title="Permalink to this headline">¶</a></a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Status:</th><td class="field-body">Draft</td>
</tr>
<tr class="field"><th class="field-name">Version:</th><td class="field-body">1.0</td>
</tr>
<tr class="field"><th class="field-name">Project owner:</th><td class="field-body">Bill Keese</td>
</tr>
<tr class="field"><th class="field-name">Available:</th><td class="field-body">since V?</td>
</tr>
</tbody>
</table>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#dropdowns-and-popups" id="id1" name="id1">Dropdowns and Popups</a><ul>
<li><a class="reference" href="#parent-widget-always-controls" id="id2" name="id2">Parent widget always controls</a></li>
<li><a class="reference" href="#popup-widget" id="id3" name="id3">Popup Widget</a></li>
<li><a class="reference" href="#lifecycle" id="id4" name="id4">Lifecycle</a></li>
<li><a class="reference" href="#stacks" id="id5" name="id5">Stacks</a></li>
<li><a class="reference" href="#keyboard-handling" id="id6" name="id6">Keyboard handling</a></li>
<li><a class="reference" href="#popup-dom-node-positioning" id="id7" name="id7">Popup DOM node positioning</a></li>
</ul>
</li>
</ul>
</div>
<p>This page explains how to drop down / popup widgets using dijit.</p>
<p>In most cases, there are two widgets involved with a popup:</p>
<blockquote>
<ul class="simple">
<li>The parent widget, that opens and closes the popup</li>
<li>The popup widget itself</li>
</ul>
</blockquote>
<p>For example, respectively, dijit.form.DropDownButton and dijit.ColorPicker.</p>
<div class="section" id="parent-widget-always-controls">
<h2><a class="toc-backref" href="#id2">Parent widget always controls<a class="headerlink" href="#parent-widget-always-controls" title="Permalink to this headline">¶</a></a></h2>
<p>It&#8217;s important to note that the parent widget both opens and closes the popup.
Even for something like dijit.TooltipDialog, the host DropDownButton widget is responsible for closing it.
This architecture was chosen so that the parent widget always knows whether it&#8217;s child popup is open or not, and also so that it can do any cleanup etc.</p>
<p>Here&#8217;s some example code from DropDownButton about how it opens and closes it&#8217;s drop down:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">dijit</span><span class="p">.</span><span class="nx">popup</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
        <span class="nx">parent</span><span class="o">:</span> <span class="k">this</span><span class="o">,</span>
        <span class="nx">popup</span><span class="o">:</span> <span class="nx">dropDown</span><span class="o">,</span>
        <span class="nx">around</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">domNode</span><span class="o">,</span>
        <span class="nx">orient</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;BR&#39;</span><span class="o">:</span><span class="s1">&#39;TR&#39;</span><span class="o">,</span> <span class="s1">&#39;BL&#39;</span><span class="o">:</span><span class="s1">&#39;TL&#39;</span><span class="o">,</span> <span class="s1">&#39;TR&#39;</span><span class="o">:</span><span class="s1">&#39;BR&#39;</span><span class="o">,</span> <span class="s1">&#39;TL&#39;</span><span class="o">:</span><span class="s1">&#39;BL&#39;</span><span class="p">}</span><span class="o">,</span>
        <span class="nx">onExecute</span><span class="o">:</span> <span class="k">function</span><span class="p">(){</span>
                <span class="nx">dijit</span><span class="p">.</span><span class="nx">popup</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">dropDown</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        <span class="nx">onCancel</span><span class="o">:</span> <span class="k">function</span><span class="p">(){</span>
                <span class="nx">dijit</span><span class="p">.</span><span class="nx">popup</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="nx">dropDown</span><span class="p">);</span>
        <span class="p">}</span><span class="o">,</span>
        <span class="nx">onClose</span><span class="o">:</span> <span class="k">function</span><span class="p">(){</span>
                <span class="p">...</span>
        <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Popup points to a dijit.ColorPicker, dijit.Menu, etc.... it can be any widget.</p>
<p>The parent code should also call dijit.popup.prepare() to hide the popup widget and to get it ready for dijit.popup.open() calls:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">dijit</span><span class="p">.</span><span class="nx">popup</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">dropDown</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="popup-widget">
<h2><a class="toc-backref" href="#id3">Popup Widget<a class="headerlink" href="#popup-widget" title="Permalink to this headline">¶</a></a></h2>
<p>Any normal widget can be used as a popup.   For example, dijit.Calendar is a normal widget (that can be displayed inline in the page) but is used as a popup by the DateTextBox widget.    In other words, there's no _PopupWidget base class for popup widgets.</p>
<p>However, there are two important methods in the popup widget that the popup widget should use to hint to the parent
widget that it's ready to be closed:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">onExecute</span><span class="o">:</span> <span class="k">function</span><span class="p">(){</span>
        <span class="c">// summary: attach point for notification about when a menu item has been executed</span>
<span class="p">}</span><span class="o">,</span>

<span class="nx">onCancel</span><span class="o">:</span> <span class="k">function</span><span class="p">(</span><span class="c">/*Boolean*/</span> <span class="nx">closeAll</span><span class="p">){</span>
        <span class="c">// summary: attach point for notification about when the user cancels the current menu</span>
<span class="p">}</span><span class="o">,</span>
</pre></div>
</div>
<p>dijit.popup will monitor calls to these two methods and inform the parent widget.</p>
<p>Here's some example code from a popup widget showing what it does when it's been clicked:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">onItemClick</span><span class="o">:</span> <span class="k">function</span><span class="p">(</span><span class="c">/*Widget*/</span> <span class="nx">item</span><span class="o">,</span> <span class="c">/*Event*/</span> <span class="nx">evt</span><span class="p">){</span>
        <span class="p">...</span>
        <span class="c">// before calling user defined handler, close hierarchy of menus</span>
        <span class="c">// and restore focus to place it was when menu was opened</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onExecute</span><span class="p">();</span>

        <span class="c">// user defined handler for click</span>
        <span class="nx">item</span><span class="p">.</span><span class="nx">onClick</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
        <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="lifecycle">
<h2><a class="toc-backref" href="#id4">Lifecycle<a class="headerlink" href="#lifecycle" title="Permalink to this headline">¶</a></a></h2>
<p>In summary, here is the lifecycle:</p>
<blockquote>
<ul class="simple">
<li>Parent widget calls dijit.popup.open() to display the popup / drop down, defining onExecute() and onCancel() callbacks.</li>
<li>[User enters input into the popup]</li>
<li>User clicks something in the popup widget, either a &quot;submit&quot;/&quot;cancel&quot; button or maybe just a color (in the case of the ColorPicker)</li>
<li>Popup widget calls this.onExecute() or this.onCancel()</li>
<li>Dijit.popup code notices the popupWidget.onExecute() / popupWidget.onCancel() has been called and informs host widget, by calling the onExecute() callback defined in the dijit.popup.open() call</li>
<li>Parent widget calls dijit.popup.close(), closing the popup widget</li>
<li>Dijit.popup.close() calls onClose() callback defined in dijit.popup.open() code.</li>
<li>Parent widget probably restores focus to whatever had focus before.</li>
<li>Popup widget executes.   Note that if the popup widget is something like an editor dialog, it now can access whatever previously had focus.  Part of the execution is likely calling this.onClick() so that any onClick handler will be called.</li>
</ul>
</blockquote>
<p>If the user clicks a blank section of the screen in order to close the popup, then the ending steps of the lifecycle are slightly different:</p>
<blockquote>
<ul class="simple">
<li>Dijit.popup code notices the click on the blank area of the screen.</li>
<li>Dijit.popup code doesn't close the popup widget directly, but rather calls the onCancel callback specified in the dijit.popup.open() call</li>
<li>Host widget closes the popup and restores focus to whatever previously had focus</li>
</ul>
</blockquote>
</div>
<div class="section" id="stacks">
<h2><a class="toc-backref" href="#id5">Stacks<a class="headerlink" href="#stacks" title="Permalink to this headline">¶</a></a></h2>
<p>DropDowns can open other drop downs.   This is particularly leveraged by the Menu widget.</p>
<p>dijit.popup() keeps track of the stack of open widgets.</p>
<p>Note that when clicking on the blank area of the screen, the stack of active popups should all close.  This isn't handled by the dijit.popup package directly.   Rather, the top parent widget should connect to _onBlur(), which will be called (only) when focus is removed from the top parent widget <em>and</em> it's descendant submenus.   In this case, the top parent widget should call dijit.popup.close() on the top popup, which will close the stack of open popups.</p>
</div>
<div class="section" id="keyboard-handling">
<h2><a class="toc-backref" href="#id6">Keyboard handling<a class="headerlink" href="#keyboard-handling" title="Permalink to this headline">¶</a></a></h2>
<p>dijit.popup() automatically monitors for the ESC key as a way to cancel the current popup, and return to the parent node (which may itself be a popup).  It calls the onCancel() callback in this case.</p>
<p>It also monitors for the TAB key, and if it sees it, it cancels the whole stack of popups (in the case of menus, where one popup has opened another and so forth).</p>
<p>Note that in neither of these cases does the dijit.popup code directly close the popup(s).  Rather, it just calls the onCancel() callback defined on the dijit.popup.open() call.   That callback then presumably calls dijit.popup.close().</p>
</div>
<div class="section" id="popup-dom-node-positioning">
<h2><a class="toc-backref" href="#id7">Popup DOM node positioning<a class="headerlink" href="#popup-dom-node-positioning" title="Permalink to this headline">¶</a></a></h2>
<p>dijit.popup.prepare() should be called on any nodes that will be used as popups.   It's main function, besides hiding the node, is to attach it as a direct child of &lt;body&gt;.  The reason we do this is so that the node doesn't get cut off if it's inside a &lt;div&gt; with a short height.  (For example, a button inside a TabContainer... the popup might want to overflow past the bottom of the TabContainer.)</p>
<p>Note that this design decision makes TAB key handling particularly difficult, and it's not handled perfectly: if a user hits the TAB key while on a submenu from a MenuBar, or any drop down from a DropDownButton, they probably expect the focus to go to the next element after the MenuBar/DropDownButton.   However, since the drop down has actually been repositioned as the last element in &amp;lt;body&amp;gt;, just letting the browser handle the tab key won't do what the user expects.</p>
<p>As a compromise, the TAB key (while on a popup) will re-focus on the DropDownButton/MenuBarItem that spawned the top popup.   This is handled by the code that calls dijit.popup.open(), in the return handler for onCancel().   See DropDownButton for an example.  (Note though that the _onBlur() handler mentioned above, for handling clicking on a blank area of the screen, should not refocus to the parent widget, as that would interefere if the user had clicked on, for example, a random &lt;input&gt; on the page and wants the focus to go there.)</p>
</div>
</div>


		      </div>
		    </div>
		  </div>
		  <div class="clearfix"></div>
	</div>
      </div>
	</div>
      <div class="clearer"></div>
    </div>
<div id="footer">
    
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
</div>
<script type="text/javascript">
	document.body.className = "nihilo";
</script>
<script type="text/javascript">
    dojo.require("docs.widget.CodeViewer");
    dojo.require("docs.widget.CompoundViewer");
</script>
<!--
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>-->

  </body>
</html>