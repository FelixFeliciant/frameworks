<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dojo.data FAQ &mdash; Dojo Toolkit v1.3.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Dojo Toolkit v1.3.0 documentation" href="../../../index.html" />
    <link rel="up" title="Quickstart" href="../../contents.html" />
    <link rel="next" title="Fetching multiple items and values" href="fetchmultiple.html" />
    <link rel="prev" title="Using Datastores" href="../usingdatastores.html" />
<script type="text/javascript">
	var djConfig = {
		parseOnLoad:true, 
		isDebug: false
	}
</script>
<script type="text/javascript" src="../../../_static/dojo/dojo/dojo.js"></script>
<style type="text/css">
@import "../../../_static/dojo/dijit/themes/dijit.css";
@import "../../../_static/dojo/dijit/themes/nihilo/nihilo.css";
@import "../../../_static/dojo/docs/widget/resources/CodeViewer.css";
@import "../../../_static/css/layout.css";
</style>

  </head>
  <body>  

    <div class="document">
	<div id="container">
      <div id="header">
	<div class="container">
		<div id="navHeader">
		  <ul>
		    <li><a href="../../../index.html">home</a> |</li>
            <li style="margin-right: 10px">
		      <a href="fetchmultiple.html" title="Fetching multiple items and values"
			 accesskey="N">next</a></li>
            <li >
		      <a href="../usingdatastores.html" title="Using Datastores"
			 accesskey="P">previous</a> |</li>
		    <li><a href="../../../contents.html">Dojo Toolkit v1.3.0 documentation</a> &raquo;</li>
		      <li><a href="../../contents.html" accesskey="U">Quickstart</a> &raquo;</li> 
		  </ul>
		</div>
		<div id="searchHeader">
		    <div class="searchContainer">
		        <form class="search" action="../../../search.html" method="get">
                    <input class="textInput" type="text" name="q" size="18" />
                    <input class="buttonInput" type="submit" value="Go" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
		    </div>
		</div>
	</div>
      </div>
      <div class="content">
	<div id="content">
		  <div id="contentRight">
			  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../../contents.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference" href="">dojo.data FAQ</a><ul>
<li><a class="reference" href="#question-1-i-called-fetch-on-a-datastore-and-the-return-value-from-the-fetch-function-doesn-t-have-my-data-why">Question 1:  I called fetch() on a datastore and the return value from the fetch function doesn&#8217;t have my data! Why?</a></li>
<li><a class="reference" href="#question-2-i-introspected-items-from-itemfilereadstore-using-javascript-associative-map-walking-and-it-has-all-these-variables-why">Question 2:  I introspected items from ItemFileReadStore using javascript associative map walking and it has all these &#8216;_&#8217; variables! Why?</a></li>
<li><a class="reference" href="#question-3-okay-you-say-dojo-data-items-are-opaque-but-i-would-like-to-convert-them-to-a-json-object-how-do-i-do-that">Question 3:  Okay, you say dojo.data items are opaque ... but I would like to convert them to a JSON object. How do I do that?</a></li>
<li><a class="reference" href="#question-4-okay-i-want-to-copy-items-from-one-store-to-another-but-if-i-directly-pass-items-i-get-errors-what-do-i-do">Question 4:  Okay, I want to copy items from one store to another, but if I directly pass items I get errors. What do I do?</a></li>
<li><a class="reference" href="#question-5-with-itemfilereadstore-and-itemfilewritestore-how-do-i-reload-the-store-contents">Question 5:  With ItemFileReadStore and ItemFileWriteStore, how do I reload the store contents?</a></li>
<li><a class="reference" href="#question-6-how-do-i-get-a-count-of-all-items-in-a-datastore">Question 6:  How do I get a count of all items in a datastore?</a></li>
<li><a class="reference" href="#question-7-do-all-datastores-have-to-use-the-format-of-data-used-by-itemfilereadstore">Question 7:  Do all datastores have to use the format of data used by ItemFileReadStore?</a></li>
<li><a class="reference" href="#question-8-i-want-to-save-my-data-with-itemfilewritestore-but-it-doesn-t-send-the-data-to-the-server-why">Question 8:  I want to save my data with ItemFileWriteStore, but it doesn&#8217;t send the data to the server. Why?</a></li>
<li><a class="reference" href="#question-9-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-when-i-access-it-through-store-getvalue-it-has-been-modified-why">Question 9:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object. When I access it through store.getValue(), it has been modified. Why?</a></li>
<li><a class="reference" href="#question-10-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-but-i-didn-t-set-an-identifier-the-store-blows-up-with-an-error-about-no-identifier-when-fetching-why-does-it-care">Question 10:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object, but I didn&#8217;t set an identifier. The store blows up with an error about no identifier when fetching. Why does it care?</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="../usingdatastores.html"
                                  title="previous chapter">Using Datastores</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="fetchmultiple.html"
                                  title="next chapter"><strong>Fetching multiple items and values</strong></a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../../_sources/quickstart/data/usingdatastores/faq.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </div>
      </div>
		  </div>
		  <div id="contentLeft">
		    <div class="bodywrapper">
		      <div class="body">
			
  <div class="section" id="dojo-data-faq">
<span id="quickstart-data-usingdatastores-faq"></span><h1><a class="toc-backref" href="#id1">dojo.data FAQ<a class="headerlink" href="#dojo-data-faq" title="Permalink to this headline">Â¶</a></a></h1>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#dojo-data-faq" id="id1" name="id1">dojo.data FAQ</a><ul>
<li><a class="reference" href="#question-1-i-called-fetch-on-a-datastore-and-the-return-value-from-the-fetch-function-doesn-t-have-my-data-why" id="id2" name="id2">Question 1:  I called fetch() on a datastore and the return value from the fetch function doesn&#8217;t have my data! Why?</a></li>
<li><a class="reference" href="#question-2-i-introspected-items-from-itemfilereadstore-using-javascript-associative-map-walking-and-it-has-all-these-variables-why" id="id3" name="id3">Question 2:  I introspected items from ItemFileReadStore using javascript associative map walking and it has all these &#8216;_&#8217; variables! Why?</a></li>
<li><a class="reference" href="#question-3-okay-you-say-dojo-data-items-are-opaque-but-i-would-like-to-convert-them-to-a-json-object-how-do-i-do-that" id="id4" name="id4">Question 3:  Okay, you say dojo.data items are opaque ... but I would like to convert them to a JSON object. How do I do that?</a></li>
<li><a class="reference" href="#question-4-okay-i-want-to-copy-items-from-one-store-to-another-but-if-i-directly-pass-items-i-get-errors-what-do-i-do" id="id5" name="id5">Question 4:  Okay, I want to copy items from one store to another, but if I directly pass items I get errors. What do I do?</a></li>
<li><a class="reference" href="#question-5-with-itemfilereadstore-and-itemfilewritestore-how-do-i-reload-the-store-contents" id="id6" name="id6">Question 5:  With ItemFileReadStore and ItemFileWriteStore, how do I reload the store contents?</a></li>
<li><a class="reference" href="#question-6-how-do-i-get-a-count-of-all-items-in-a-datastore" id="id7" name="id7">Question 6:  How do I get a count of all items in a datastore?</a></li>
<li><a class="reference" href="#question-7-do-all-datastores-have-to-use-the-format-of-data-used-by-itemfilereadstore" id="id8" name="id8">Question 7:  Do all datastores have to use the format of data used by ItemFileReadStore?</a></li>
<li><a class="reference" href="#question-8-i-want-to-save-my-data-with-itemfilewritestore-but-it-doesn-t-send-the-data-to-the-server-why" id="id9" name="id9">Question 8:  I want to save my data with ItemFileWriteStore, but it doesn&#8217;t send the data to the server. Why?</a></li>
<li><a class="reference" href="#question-9-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-when-i-access-it-through-store-getvalue-it-has-been-modified-why" id="id10" name="id10">Question 9:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object. When I access it through store.getValue(), it has been modified. Why?</a></li>
<li><a class="reference" href="#question-10-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-but-i-didn-t-set-an-identifier-the-store-blows-up-with-an-error-about-no-identifier-when-fetching-why-does-it-care" id="id11" name="id11">Question 10:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object, but I didn&#8217;t set an identifier. The store blows up with an error about no identifier when fetching. Why does it care?</a></li>
</ul>
</li>
</ul>
</div>
<p>This section is intended as a point to put answers to the common questions posed by users of dojo.data.</p>
<div class="section" id="question-1-i-called-fetch-on-a-datastore-and-the-return-value-from-the-fetch-function-doesn-t-have-my-data-why">
<h2><a class="toc-backref" href="#id2">Question 1:  I called fetch() on a datastore and the return value from the fetch function doesn&#8217;t have my data! Why?<a class="headerlink" href="#question-1-i-called-fetch-on-a-datastore-and-the-return-value-from-the-fetch-function-doesn-t-have-my-data-why" title="Permalink to this headline">Â¶</a></a></h2>
<p>Because the dojo.data API is asynchronous be definition. The return value from fetch will generally not have any data on it. It&#8217;s intended as a point for stores to store an abort() function for a request and a place for stores to put internal cache details and the like. It is not intended to gand back data items. Data items are always returned through the callbacks to fetch().</p>
</div>
<div class="section" id="question-2-i-introspected-items-from-itemfilereadstore-using-javascript-associative-map-walking-and-it-has-all-these-variables-why">
<h2><a class="toc-backref" href="#id3">Question 2:  I introspected items from ItemFileReadStore using javascript associative map walking and it has all these &#8216;_&#8217; variables! Why?<a class="headerlink" href="#question-2-i-introspected-items-from-itemfilereadstore-using-javascript-associative-map-walking-and-it-has-all-these-variables-why" title="Permalink to this headline">Â¶</a></a></h2>
<p>Items from a datastore are supposed to be treated as opaque handles. This is by definition of the API, which can be read in the <a class="reference" href="../../../dojo/data/api.html#dojo-data-api"><em>API section</em></a>. dojo.data.ItemFileReadStore and dojo.data.ItemFileWriteStore store several bits of important internal information on each item, such as what store instance it came form, what its internal index is (for O(1) lookup performance), and internal maps of who has references to the item. This is all critical information needed by the store to make item processing efficient. It is also information that should never be relied on directly, it should only be used by the store itself.</p>
<p>All store access should go through the <a class="reference" href="../../../dojo/data/api/Read.html#dojo-data-api-read"><em>dojo.data.api.Read</em></a> functions. Below is a list of the common functions and what you use them for:</p>
<ul class="simple">
<li><strong>store.getAttributes(item):</strong>  Returns an array list of all public attributes of an item. Only attributes returned in this list should ever be used as data.</li>
<li><strong>store.getValue(item, attribute):</strong> The function you use to get a single value from an attribute of a data item. For multi-valued attributes, you should use store.getValues(item, attribute);</li>
</ul>
</div>
<div class="section" id="question-3-okay-you-say-dojo-data-items-are-opaque-but-i-would-like-to-convert-them-to-a-json-object-how-do-i-do-that">
<h2><a class="toc-backref" href="#id4">Question 3:  Okay, you say dojo.data items are opaque ... but I would like to convert them to a JSON object. How do I do that?<a class="headerlink" href="#question-3-okay-you-say-dojo-data-items-are-opaque-but-i-would-like-to-convert-them-to-a-json-object-how-do-i-do-that" title="Permalink to this headline">Â¶</a></a></h2>
<p>This is actually not difficult to do. This is done through usage of the dojo.data.api.Read specification. The code you would use to create a JSON structure from a dojo.data item is the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">function</span> <span class="nx">itemToJSON</span><span class="p">(</span><span class="nx">store</span><span class="o">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// summary: Function to convert an item into a JSON format.</span>
  <span class="c">// store:</span>
  <span class="c">//    The datastore the item came from.</span>
  <span class="c">// item:</span>
  <span class="c">//    The item in question.</span>
  <span class="k">var</span> <span class="nx">json</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">&amp;&amp;</span> <span class="nx">store</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">//Determine the attributes we need to process.</span>
    <span class="k">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getAttributes</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">getValues</span><span class="p">(</span><span class="nx">item</span><span class="o">,</span> <span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
          <span class="c">//Handle multivalued and single-valued attributes.</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nx">j</span><span class="o">;</span>
            <span class="nx">json</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
              <span class="k">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
              <span class="c">//Check that the value isn&#39;t another item. If it is, process it as an item.</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">isItem</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">json</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">dojo</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">(</span><span class="nx">itemToJSON</span><span class="p">(</span><span class="nx">store</span><span class="o">,</span> <span class="nx">value</span><span class="p">)));</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">json</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">isItem</span><span class="p">(</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
               <span class="nx">json</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">fromJson</span><span class="p">(</span><span class="nx">itemToJSON</span><span class="p">(</span><span class="nx">store</span><span class="o">,</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="nx">json</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">toJson</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="question-4-okay-i-want-to-copy-items-from-one-store-to-another-but-if-i-directly-pass-items-i-get-errors-what-do-i-do">
<h2><a class="toc-backref" href="#id5">Question 4:  Okay, I want to copy items from one store to another, but if I directly pass items I get errors. What do I do?<a class="headerlink" href="#question-4-okay-i-want-to-copy-items-from-one-store-to-another-but-if-i-directly-pass-items-i-get-errors-what-do-i-do" title="Permalink to this headline">Â¶</a></a></h2>
<p>By definition, items are unique to their store instance, so you cannot generally pass an item from store A to store B without getting errors. What you must do is copy the data from one store to another. The technique for this is actually very similar to the technique described in question 3. You must iterate over the items attributes, build a JavaScript Object of them, then on the target store, call 'newItem' to create the copy of the item. Psuedocode for this would be like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">var</span> <span class="nx">origStore</span> <span class="o">=</span> <span class="nx">some</span><span class="p">.</span><span class="nx">datastore</span><span class="p">();</span>
<span class="k">var</span> <span class="nx">newStore</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="k">function</span> <span class="nx">onComplete</span><span class="p">(</span><span class="nx">items</span><span class="o">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">newStore</span> <span class="o">=</span> <span class="nx">some</span><span class="p">.</span><span class="nx">datastore</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">items</span> <span class="o">&amp;&amp;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nx">i</span><span class="o">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">origStore</span><span class="p">.</span><span class="nx">getAttributes</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">attributes</span> <span class="o">&amp;&amp;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">j</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">var</span> <span class="nx">newItem</span> <span class="o">=</span> <span class="p">{};</span>
          <span class="k">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">origStore</span><span class="p">.</span><span class="nx">getValues</span><span class="p">(</span><span class="nx">item</span><span class="o">,</span> <span class="nx">attributes</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>

          <span class="c">//Be careful here. If you reference other items then those too have to be cloned over in a similar manner (iterating over the attributes and building up a structure for a newItem call. This pseudocode doesn&#39;t really take that into accoumt.</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="c">//Create a copy.</span>
              <span class="nx">newItem</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">newItem</span><span class="p">[</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">j</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">newStore</span><span class="p">.</span><span class="nx">newItem</span><span class="p">(</span><span class="nx">newItem</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">origStore</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span><span class="p">{}</span> <span class="o">,</span> <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">onComplete</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="question-5-with-itemfilereadstore-and-itemfilewritestore-how-do-i-reload-the-store-contents">
<h2><a class="toc-backref" href="#id6">Question 5:  With ItemFileReadStore and ItemFileWriteStore, how do I reload the store contents?<a class="headerlink" href="#question-5-with-itemfilereadstore-and-itemfilewritestore-how-do-i-reload-the-store-contents" title="Permalink to this headline">Â¶</a></a></h2>
<p>Use the two constructor options added in 1.2, <em>clearOnClose</em> and <em>urlPreventCache</em>. Then when you want to reload, call close(). It will flush the internal store structures and reload everything from the server or whatnot.</p>
</div>
<div class="section" id="question-6-how-do-i-get-a-count-of-all-items-in-a-datastore">
<h2><a class="toc-backref" href="#id7">Question 6:  How do I get a count of all items in a datastore?<a class="headerlink" href="#question-6-how-do-i-get-a-count-of-all-items-in-a-datastore" title="Permalink to this headline">Â¶</a></a></h2>
<p>You do a fetch that queries for all items, then use the onBegin callback function. In the dojo.data.api.Read spec, the onBegin callback function's first parameter is the total size of the match, regardless of what start and count were configured to. This is so you have a way of knowing the total match outside of the returned page so that you can configure your client side display appropriately. The simplest way to get a size back, but no items would be to do something like:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">function</span> <span class="nx">size</span><span class="p">(</span><span class="nx">size</span><span class="o">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">//Do whatever with the size var.</span>
<span class="p">}</span>

<span class="nx">store</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span><span class="nx">query</span><span class="o">:</span> <span class="p">{}</span><span class="o">,</span> <span class="nx">onBegin</span><span class="o">:</span> <span class="nx">size</span><span class="o">,</span> <span class="nx">start</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">count</span><span class="o">:</span> <span class="mi">0</span><span class="p">});</span>
</pre></div>
</div>
<p>That should return no items but give you the size of the match.</p>
<p>The reason for this is that not all stores keep every item in memory in the browser. This would be fundamentally impossible if there was an item set of well over one million entries, which is where server backed datastores come in. For server backed datastores, you have no possible way of knowing the size of the data set (which could be changing as operations occur from other clients in a multi-user web app) at any particular moment without a query to the server ... which naturally gets into invoking a fetch.</p>
<p>The data API was designed to hide whether or not all items are in memory, or are stored on some remote service.</p>
</div>
<div class="section" id="question-7-do-all-datastores-have-to-use-the-format-of-data-used-by-itemfilereadstore">
<h2><a class="toc-backref" href="#id8">Question 7:  Do all datastores have to use the format of data used by ItemFileReadStore?<a class="headerlink" href="#question-7-do-all-datastores-have-to-use-the-format-of-data-used-by-itemfilereadstore" title="Permalink to this headline">Â¶</a></a></h2>
<p>No. A store's internal data format can be whatever is most efficient for that store to work with. For example, dojox.data.XmlStore's input data format is XML, not JSON. The API is intended to adapt over new as well as existing, data services on the web and expose data items on a common fashion, regardless of the actual backing transport format.</p>
</div>
<div class="section" id="question-8-i-want-to-save-my-data-with-itemfilewritestore-but-it-doesn-t-send-the-data-to-the-server-why">
<h2><a class="toc-backref" href="#id9">Question 8:  I want to save my data with ItemFileWriteStore, but it doesn't send the data to the server. Why?<a class="headerlink" href="#question-8-i-want-to-save-my-data-with-itemfilewritestore-but-it-doesn-t-send-the-data-to-the-server-why" title="Permalink to this headline">Â¶</a></a></h2>
<p>Because it doesn't know how to send it to your specific server/service implementation. dojo.data.ItemFileWriteStore's default save behavior is to commit data into internal memory structures only. It provides over-ridable hook functions that users must provide in order to send data to an external service. See the <a class="reference" href="../../../dojo/data/ItemFileWriteStore.html#dojo-data-itemfilewritestore"><em>Write Section</em></a> of the ItemFileWriteStore docs.</p>
</div>
<div class="section" id="question-9-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-when-i-access-it-through-store-getvalue-it-has-been-modified-why">
<h2><a class="toc-backref" href="#id10">Question 9:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object. When I access it through store.getValue(), it has been modified. Why?<a class="headerlink" href="#question-9-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-when-i-access-it-through-store-getvalue-it-has-been-modified-why" title="Permalink to this headline">Â¶</a></a></h2>
<p>This is because child objects (non-atomic values such as int, string, etc), are automatically treated as data store items by dojo.data.ItemFileReadStore. So, when it processes that attribute, it updates it into ItemFileReadStore internal format and therefore
attributes on it should also be accessed through store functions, such as getValue(). This is easily detectable by using the ItemFileReadStore's isItem() function.</p>
<p>If you want to prevent ItemFileReadStore from converting Object types into data store items, you will need to use a custom type map, and define your object as a specific type that can be serialized to and from JSON using the custom type formatters. See the <a class="reference" href="../../../dojo/data/ItemFileReadStore.html#dojo-data-itemfilereadstore"><em>custom types</em></a> documentation for more details.</p>
</div>
<div class="section" id="question-10-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-but-i-didn-t-set-an-identifier-the-store-blows-up-with-an-error-about-no-identifier-when-fetching-why-does-it-care">
<h2><a class="toc-backref" href="#id11">Question 10:  In one of my items in ItemFileReadStore I defined an attribute value as a JavaScript object, but I didn't set an identifier. The store blows up with an error about no identifier when fetching. Why does it care?<a class="headerlink" href="#question-10-in-one-of-my-items-in-itemfilereadstore-i-defined-an-attribute-value-as-a-javascript-object-but-i-didn-t-set-an-identifier-the-store-blows-up-with-an-error-about-no-identifier-when-fetching-why-does-it-care" title="Permalink to this headline">Â¶</a></a></h2>
<p>This question is easier to understand with a bit of sample ItemFile*Store input. Consider the following:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;identifier&quot;</span><span class="o">:</span> <span class="s2">&quot;myid&quot;</span><span class="o">,</span>
  <span class="s2">&quot;label&quot;</span><span class="o">:</span> <span class="s2">&quot;name&quot;</span><span class="o">,</span>
  <span class="s2">&quot;items&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span><span class="o">,</span>
        <span class="s2">&quot;myid&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="o">,</span>
        <span class="s2">&quot;someObject&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;someValue&quot;</span><span class="o">:</span> <span class="s2">&quot;bar&quot;</span>
        <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note above that the child object nested off someValue doesn't have a <em>myid</em> attribute. Why does this cause ItemFile*Store an issue. This is effectively answered by question 9 on this page. This is because child objects (non-atomic values such as int, string, etc), are automatically treated as data store items by dojo.data.ItemFileReadStore.</p>
<p>Because it is treated as a datastore item, it must have an identifier to comply with the needs of the <a class="reference" href="../../../dojo/data/api/Identity.html#dojo-data-api-identity"><em>dojo.data.api.Identity</em></a> specification. Identity requires that all items be able to be uniquely looked up by an identifier. It does not state in a hierarchy of items only root items can be looked up by an identifier. Therefore, for ItemFile*Store, if you define the <em>identifier</em> option of the data set, you must make sure that all child items have unqiue identifiers as well so the Identity API implementation can be satisfied.</p>
<p>This is also necessary for support for widgets like dijit.Tree, when write support is required. It needs the capability of looking up an item from a store by its identifier, regardless of its position (root item or child of another item). Effectively, if an object in a datastore is identifiable as a datastore item (store.isItem(possibleItem)), and that store implements the Identity API, then that item must return a value for store.getIdentity(possibleItem). In other words, Hierarchy is irrelevant to whether or not an item has an identifier. All data store items in an Identity implementing store must return a value that can then be used to look the item back up later.</p>
<p>You have options with ItemFile*Store in how it handles nested/child objects. They are as follows:</p>
<blockquote>
<ul class="simple">
<li>Apply identifier attribute that is unique to ALL JavaScript objects in the data you are passing as data store items.</li>
</ul>
</blockquote>
<p>OR:</p>
<blockquote>
<ul class="simple">
<li>Don't assign an attribute the role of identifier and let the store auto-assign unique ones.</li>
</ul>
</blockquote>
<p>OR:</p>
<blockquote>
<ul class="simple">
<li>Use a custom type map to make the ItemFile*Store treat the complex object field value as a straight value and not a data store item.</li>
</ul>
</blockquote>
</div>
</div>


		      </div>
		    </div>
		  </div>
		  <div class="clearfix"></div>
	</div>
      </div>
	</div>
      <div class="clearer"></div>
    </div>
<div id="footer">
    
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
</div>
<script type="text/javascript">
	document.body.className = "nihilo";
</script>
<script type="text/javascript">
    dojo.require("docs.widget.CodeViewer");
    dojo.require("docs.widget.CompoundViewer");
</script>
<!--
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>-->

  </body>
</html>