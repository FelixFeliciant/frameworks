<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Fetching multiple items and values &mdash; Dojo Toolkit v1.3.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.3.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Dojo Toolkit v1.3.0 documentation" href="../../../index.html" />
    <link rel="up" title="Quickstart" href="../../contents.html" />
    <link rel="next" title="Selecting single items" href="fetchsingle.html" />
    <link rel="prev" title="dojo.data FAQ" href="faq.html" />
<script type="text/javascript">
	var djConfig = {
		parseOnLoad:true, 
		isDebug: false
	}
</script>
<script type="text/javascript" src="../../../_static/dojo/dojo/dojo.js"></script>
<style type="text/css">
@import "../../../_static/dojo/dijit/themes/dijit.css";
@import "../../../_static/dojo/dijit/themes/nihilo/nihilo.css";
@import "../../../_static/dojo/docs/widget/resources/CodeViewer.css";
@import "../../../_static/css/layout.css";
</style>

  </head>
  <body>  

    <div class="document">
	<div id="container">
      <div id="header">
	<div class="container">
		<div id="navHeader">
		  <ul>
		    <li><a href="../../../index.html">home</a> |</li>
            <li style="margin-right: 10px">
		      <a href="fetchsingle.html" title="Selecting single items"
			 accesskey="N">next</a></li>
            <li >
		      <a href="faq.html" title="dojo.data FAQ"
			 accesskey="P">previous</a> |</li>
		    <li><a href="../../../contents.html">Dojo Toolkit v1.3.0 documentation</a> &raquo;</li>
		      <li><a href="../../contents.html" accesskey="U">Quickstart</a> &raquo;</li> 
		  </ul>
		</div>
		<div id="searchHeader">
		    <div class="searchContainer">
		        <form class="search" action="../../../search.html" method="get">
                    <input class="textInput" type="text" name="q" size="18" />
                    <input class="buttonInput" type="submit" value="Go" />
                    <input type="hidden" name="check_keywords" value="yes" />
                    <input type="hidden" name="area" value="default" />
                </form>
		    </div>
		</div>
	</div>
      </div>
      <div class="content">
	<div id="content">
		  <div id="contentRight">
			  
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="../../../contents.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference" href=""><strong>Fetching multiple items and values</strong></a><ul>
<li><a class="reference" href="#working-with-multiple-items">Working with Multiple Items</a></li>
<li><a class="reference" href="#functional-examples">Functional Examples</a><ul>
<li><a class="reference" href="#loading-all-items-through-callbacks">Loading all items through callbacks</a></li>
</ul>
</li>
<li><a class="reference" href="#working-with-lots-of-items">Working with Lots of Items</a></li>
<li><a class="reference" href="#functional-onitem-examples">Functional onItem Examples</a><ul>
<li><a class="reference" href="#loading-all-items-through-the-onitem-callback">Loading all items through the onItem callback</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="faq.html"
                                  title="previous chapter">dojo.data FAQ</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="fetchsingle.html"
                                  title="next chapter">Selecting single items</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../../../_sources/quickstart/data/usingdatastores/fetchmultiple.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
        </div>
      </div>
		  </div>
		  <div id="contentLeft">
		    <div class="bodywrapper">
		      <div class="body">
			
  <div class="section" id="fetching-multiple-items-and-values">
<span id="quickstart-data-usingdatastores-fetchmultiple"></span><h1><a class="toc-backref" href="#id1"><strong>Fetching multiple items and values</strong><a class="headerlink" href="#fetching-multiple-items-and-values" title="Permalink to this headline">¶</a></a></h1>
<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#fetching-multiple-items-and-values" id="id1" name="id1"><strong>Fetching multiple items and values</strong></a><ul>
<li><a class="reference" href="#working-with-multiple-items" id="id2" name="id2">Working with Multiple Items</a></li>
<li><a class="reference" href="#functional-examples" id="id3" name="id3">Functional Examples</a><ul>
<li><a class="reference" href="#loading-all-items-through-callbacks" id="id4" name="id4">Loading all items through callbacks</a></li>
</ul>
</li>
<li><a class="reference" href="#working-with-lots-of-items" id="id5" name="id5">Working with Lots of Items</a></li>
<li><a class="reference" href="#functional-onitem-examples" id="id6" name="id6">Functional onItem Examples</a><ul>
<li><a class="reference" href="#loading-all-items-through-the-onitem-callback" id="id7" name="id7">Loading all items through the onItem callback</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="working-with-multiple-items">
<h2><a class="toc-backref" href="#id2">Working with Multiple Items<a class="headerlink" href="#working-with-multiple-items" title="Permalink to this headline">¶</a></a></h2>
<p>You will likely want to access multiple items from such a data source as in the preceding example. No problem! Dojo.data Read API provides a mechanism for loading a set of items. All you have to do is provide the following information to the fetch function of the Read API:</p>
<ul class="simple">
<li>This is what I want (if I don&#8217;t tell you something, get everything)</li>
<li>Do this if there is an error</li>
<li>Do that when everything is loaded</li>
</ul>
<p>If this sounds like it might be event-driven, that&#8217;s because it is.  Most I/O methods in Ajax must perform operations asynchronously, so results and errors have to be returned through events (commonly called callbacks).  Because of the asynchronous requirements of the I/O methods, the dojo.data API was designed to operate in an asynchronous manner and use events for item retrieval.  Obtaining multiple items is one of the primary operations of dojo.data that people will use and first experience the necessities of callbacks.</p>
<p>This page demonstrates the absolute basics of obtaining multiple items in one request.  The prime method called is the  dojo.data.api.Read.fetch()</p>
<p>In the following examples, the Read API is used with the following values:</p>
<dl class="docutils">
<dt><strong>fetch()</strong></dt>
<dd>Asynchronous API that fetches a set of items which match a list of attributes.</dd>
<dt><strong>getValue()</strong></dt>
<dd>Takes an item and an attribute and returns the associated value.</dd>
</dl>
<p>The following example code fragment returns all items:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">var</span> <span class="nx">pantryStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ItemFileReadStore</span><span class="p">({</span> <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;pantry_items.json&quot;</span> <span class="p">});</span>
<span class="c">//Define a callback that fires when all the items are returned.</span>
<span class="k">var</span> <span class="nx">gotList</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">items</span><span class="o">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="k">var</span> <span class="nx">itemsList</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">;</span>
  <span class="nx">dojo</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">items</span><span class="o">,</span> <span class="k">function</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span>
    <span class="nx">itemsList</span> <span class="o">+=</span> <span class="nx">pantryStore</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">;</span>
  <span class="p">});</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;All items are: &quot;</span> <span class="o">+</span> <span class="nx">itemsList</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">var</span> <span class="nx">gotError</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">error</span><span class="o">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;The request to the store failed. &quot;</span> <span class="o">+</span>  <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
<span class="c">//Invoke the search</span>
<span class="nx">pantryStore</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
  <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">gotList</span><span class="o">,</span>
  <span class="nx">onError</span><span class="o">:</span> <span class="nx">gotError</span>
<span class="p">});</span>
</pre></div>
</div>
<p>That's great, but what is more useful is seeing a completely functional example.  In the following example, clicking a button retrieves a list of items and displays them.  Please note that this is a simple example using ItemFileReadStore, but the concepts it presents applies to all Data Stores.</p>
</div>
<div class="section" id="functional-examples">
<h2><a class="toc-backref" href="#id3">Functional Examples<a class="headerlink" href="#functional-examples" title="Permalink to this headline">¶</a></a></h2>
<div class="section" id="loading-all-items-through-callbacks">
<h3><a class="toc-backref" href="#id4">Loading all items through callbacks<a class="headerlink" href="#loading-all-items-through-callbacks" title="Permalink to this headline">¶</a></a></h3>
<div dojoType="docs.widget.CompoundViewer"><div dojoType="docs.widget.CodeViewer" label="" lang="javascript"><pre>&lt;script&gt;
  dojo.require(&quot;dojo.data.ItemFileReadStore&quot;);
  dojo.require(&quot;dijit.form.Button&quot;);

  var storeData = { identifier: 'name',
    items: [
      { name: 'Adobo', aisle: 'Mexican', price: 3.01 },
      { name: 'Balsamic vinegar', aisle: 'Condiments', price: 4.01 },
      { name: 'Basil', aisle: 'Spices', price: 3.59  },
      { name: 'Bay leaf', aisle: 'Spices',  price: 2.01 },
      { name: 'Beef Bouillon Granules', aisle: 'Soup',  price: 5.01 },
      { name: 'Vinegar', aisle: 'Condiments',  price: 1.99  },
      { name: 'White cooking wine', aisle: 'Condiments',  price: 2.01 },
      { name: 'Worcestershire Sauce', aisle: 'Condiments',  price: 3.99 },
      { name: 'pepper', aisle: 'Spices',  price: 1.01  }
    ]};

    //This function performs some basic dojo initialization.  In this case it connects the button
    //onClick to a function which invokes the fetch().  The fetch function queries for all items
    //and provides callbacks to use for completion of data retrieval or reporting of errors.
    function init () {
       //Function to perform a fetch on the datastore when a button is clicked
       function getAllItems () {

         //Callback to perform an action when the data items are starting to be returned:
         function clearOldList(size, request) {
           var list = dojo.byId(&quot;list&quot;);
           if (list) {
             while (list.firstChild) {
               list.removeChild(list.firstChild);
             }
           }
         }

         //Callback for processing a returned list of items.
         function gotItems(items, request) {
           var list = dojo.byId(&quot;list&quot;);
           if (list) {
             var i;
             for (i = 0; i &lt; items.length; i++) {
               var item = items[i];
               list.appendChild(document.createTextNode(foodStore.getValue(item, &quot;name&quot;)));
               list.appendChild(document.createElement(&quot;br&quot;));
             }
           }
         }

         //Callback for if the lookup fails.
         function fetchFailed(error, request) {
            alert(&quot;lookup failed.&quot;);
         }

         //Fetch the data.
         foodStore.fetch({onBegin: clearOldList, onComplete: gotItems, onError: fetchFailed});

       }
       //Link the click event of the button to driving the fetch.
       dojo.connect(button, &quot;onClick&quot;, getAllItems);
    }
    //Set the init function to run when dojo loading and page parsing has completed.
    dojo.addOnLoad(init);
&lt;/script&gt;</pre></div><div dojoType="docs.widget.CodeViewer" label="" lang="html"><pre>&lt;div dojoType=&quot;dojo.data.ItemFileReadStore&quot; data=&quot;storeData&quot; jsId=&quot;foodStore&quot;&gt;&lt;/div&gt;
&lt;div dojoType=&quot;dijit.form.Button&quot; jsId=&quot;button&quot;&gt;Click me for a list!&lt;/div&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span id=&quot;list&quot;&gt;
&lt;/span&gt;</pre></div></div></div>
</div>
<div class="section" id="working-with-lots-of-items">
<h2><a class="toc-backref" href="#id5">Working with Lots of Items<a class="headerlink" href="#working-with-lots-of-items" title="Permalink to this headline">¶</a></a></h2>
<p>Now that we've looked at dealing with getting a list of items in one batch, what if the list is huge? It could take a long time to get all the items, push them into an array, and then call the callback with the array of items. Wouldn't it be nice if you could stream the items in, one at a time, and do something each time a new item is available? Well, with dojo.data, you can do that! There is an alternate callback you can pass to fetch() that is called on an item by item basis. It is the onItem callback.</p>
<p>In the following examples, the code will request that all items be returned (an empty query). As each item gets returned, it will add a textnode to the document. In this example, the Read API is used with the following values:</p>
<dl class="docutils">
<dt><strong>fetch()</strong></dt>
<dd>Asynchronous API that fetches a set of items which match a list of attributes.</dd>
<dt><strong>getValue()</strong></dt>
<dd>Takes an item and an attribute and returns the associated value.</dd>
</dl>
<p>The following code fragment loads all items and streams them back into the page:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="k">var</span> <span class="nx">pantryStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">ItemFileReadStore</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;pantry_items.json&quot;</span> <span class="p">}</span> <span class="p">);</span>
<span class="k">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">body</span><span class="p">();</span> <span class="c">// node to put output in</span>

<span class="c">// Define the onComplete callback to write</span>
<span class="c">// COMPLETED to the page when the fetch has</span>
<span class="c">// finished returning items.</span>
<span class="k">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">items</span><span class="o">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="s2">&quot;COMPLETED&quot;</span><span class="p">));</span>
<span class="p">}</span>

<span class="c">//Define the callback that appends a textnode into the document each time an item is returned.</span>
<span class="nx">gotItem</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">item</span><span class="o">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span>
      <span class="nx">pantryStore</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span><span class="nx">item</span><span class="o">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">);</span>
  <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;br&quot;</span><span class="p">));</span>
<span class="p">}</span>

<span class="c">//Define a simple error handler.</span>
<span class="k">var</span> <span class="nx">gotError</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="nx">error</span><span class="o">,</span> <span class="nx">request</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;The request to the store failed. &quot;</span> <span class="o">+</span>  <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>

<span class="c">//Invoke the search</span>
<span class="nx">pantryStore</span><span class="p">.</span><span class="nx">fetch</span><span class="p">({</span>
  <span class="nx">onComplete</span><span class="o">:</span> <span class="nx">done</span><span class="o">,</span>
  <span class="nx">onItem</span><span class="o">:</span> <span class="nx">gotItem</span><span class="o">,</span>
  <span class="nx">onError</span><span class="o">:</span> <span class="nx">gotError</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Now, to demonstrate this concept in a functional example. In the following example, clicking a button retrieves a list of items and displays them.  Please note that this is a simple example using ItemFileReadStore, but the concepts it presents applies to all Data Stores.</p>
</div>
<div class="section" id="functional-onitem-examples">
<h2><a class="toc-backref" href="#id6">Functional onItem Examples<a class="headerlink" href="#functional-onitem-examples" title="Permalink to this headline">¶</a></a></h2>
<div class="section" id="loading-all-items-through-the-onitem-callback">
<h3><a class="toc-backref" href="#id7">Loading all items through the onItem callback<a class="headerlink" href="#loading-all-items-through-the-onitem-callback" title="Permalink to this headline">¶</a></a></h3>
<div dojoType="docs.widget.CompoundViewer"><div dojoType="docs.widget.CodeViewer" label="" lang="javascript"><pre>&lt;script&gt;
  dojo.require(&quot;dojo.data.ItemFileReadStore&quot;);
  dojo.require(&quot;dijit.form.Button&quot;);

  var storeData2 = { identifier: 'name',
    items: [
      { name: 'Adobo', aisle: 'Mexican', price: 3.01 },
      { name: 'Balsamic vinegar', aisle: 'Condiments', price: 4.01 },
      { name: 'Basil', aisle: 'Spices', price: 3.59  },
      { name: 'Bay leaf', aisle: 'Spices',  price: 2.01 },
      { name: 'Beef Bouillon Granules', aisle: 'Soup',  price: 5.01 },
      { name: 'Vinegar', aisle: 'Condiments',  price: 1.99  },
      { name: 'White cooking wine', aisle: 'Condiments',  price: 2.01 },
      { name: 'Worcestershire Sauce', aisle: 'Condiments',  price: 3.99 },
      { name: 'pepper', aisle: 'Spices',  price: 1.01  }
    ]};

    //This function performs some basic dojo initialization.  In this case it connects the button
    //onClick to a function which invokes the fetch().  The fetch function queries for all items
    //and provides callbacks to use for completion of data retrieval or reporting of errors.
    function init2 () {
       //Function to perform a fetch on the datastore when a button is clicked
       function getStreamingItems () {

         //Callback to perform an action when the data items are starting to be returned:
         function clearOldList(size, request) {
           var list = dojo.byId(&quot;list2&quot;);
           if (list) {
             while (list.firstChild) {
               list.removeChild(list.firstChild);
             }
           }
         }

         //Callback for processing a single returned item.
         function gotItem(item, request) {
           var list = dojo.byId(&quot;list2&quot;);
           if (list) {
             if (item) {
               list.appendChild(document.createTextNode(foodStore.getValue(item, &quot;name&quot;)));
               list.appendChild(document.createElement(&quot;br&quot;));
             }
           }
         }

         //Callback for if the lookup fails.
         function fetchFailed(error, request) {
            alert(&quot;lookup failed.&quot;);
         }

         //Fetch the data.
         foodStore.fetch({onBegin: clearOldList, onItem: gotItem, onError: fetchFailed});
       }

       //Link the click event of the button to driving the fetch.
       dojo.connect(button2, &quot;onClick&quot;, getStreamingItems);
    }
    //Set the init function to run when dojo loading and page parsing has completed.
    dojo.addOnLoad(init2);
&lt;/script&gt;</pre></div><div dojoType="docs.widget.CodeViewer" label="" lang="html"><pre>&lt;div dojoType=&quot;dojo.data.ItemFileReadStore&quot; data=&quot;storeData2&quot; jsId=&quot;foodStore2&quot;&gt;&lt;/div&gt;
&lt;div dojoType=&quot;dijit.form.Button&quot; jsId=&quot;button2&quot;&gt;Click me for a list!&lt;/div&gt;
&lt;br&gt;
&lt;br&gt;
&lt;span id=&quot;list2&quot;&gt;
&lt;/span&gt;</pre></div></div><p><strong>Note:</strong> If the onItem callback is present in the parameters to fetch, then the first parameter to the onComplete callback, the items array, will always be null. Therefore, onItem is streaming only mode and does not rely on onComplete for anything other than a signal that the streaming has ended.</p>
</div>
</div>
</div>


		      </div>
		    </div>
		  </div>
		  <div class="clearfix"></div>
	</div>
      </div>
	</div>
      <div class="clearer"></div>
    </div>
<div id="footer">
    
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
</div>
<script type="text/javascript">
	document.body.className = "nihilo";
</script>
<script type="text/javascript">
    dojo.require("docs.widget.CodeViewer");
    dojo.require("docs.widget.CompoundViewer");
</script>
<!--
    <div class="footer">
      &copy; Copyright 2009, Dojo Foundation.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>-->

  </body>
</html>